(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["PageCreate"],{"0705":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",[a("a-input",{attrs:{placeholder:"请输入标题"},model:{value:t.queryParam.title,callback:function(e){t.$set(t.queryParam,"title",e)},expression:"queryParam.title"}}),a("a-switch",{on:{change:t.onChange},model:{value:t.queryParam.isSource,callback:function(e){t.$set(t.queryParam,"isSource",e)},expression:"queryParam.isSource"}}),a("mavon-editor",{ref:"md",staticStyle:{"min-height":"600px","z-index":"1"},on:{change:t.change,imgAdd:t.imgAdd,imgDel:t.imgDel},model:{value:t.queryParam.originalContent,callback:function(e){t.$set(t.queryParam,"originalContent",e)},expression:"queryParam.originalContent"}}),a("div",{staticClass:"article-bottom"},[a("div",{staticClass:"article-option"},[a("a-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("保存")]),a("a-button",{attrs:{type:"primary"},on:{click:t.preview}},[t._v("预览")]),a("a-button",{attrs:{type:"primary"},on:{click:t.showDrawer}},[t._v("打开发布面板")]),a("a-button",{attrs:{type:"primary"},on:{click:t.openAttachement}},[t._v("附件库")])],1)]),a("a-drawer",{attrs:{title:"创建或跟新页面",placement:"right",closable:!1,visible:t.visible,width:"30rem"},on:{close:t.onClose}},[a("a-form-item",{attrs:{label:"页面名称"}},[a("a-input",{model:{value:t.queryParam.title,callback:function(e){t.$set(t.queryParam,"title",e)},expression:"queryParam.title"}})],1),t.template?a("a-form-item",{attrs:{label:"资源"}},[a("a-textarea",{model:{value:t.template.resource,callback:function(e){t.$set(t.template,"resource",e)},expression:"template.resource"}})],1):t._e(),a("a-form",[a("a-form-item",{attrs:{label:"视图路径"}},[a("a-input",{attrs:{placeholder:"请输入视图路径"},model:{value:t.queryParam.viewName,callback:function(e){t.$set(t.queryParam,"viewName",e)},expression:"queryParam.viewName"}})],1),a("a-form-item",{attrs:{label:"选择模板"}},[a("a-select",{staticStyle:{width:"100%"},on:{change:t.handleChange},model:{value:t.queryParam.templateName,callback:function(e){t.$set(t.queryParam,"templateName",e)},expression:"queryParam.templateName"}},t._l(t.templates,(function(e){return a("a-select-option",{key:e.id,attrs:{value:e.enName}},[t._v(t._s(e.name))])})),1)],1),a("a-form-item",[a("a-button",{on:{click:t.submit}},[t._v("发布")])],1)],1)],1),a("a-drawer",{attrs:{title:"附件库",placement:"right",closable:!1,visible:t.attachemnetVisible,width:"30rem"},on:{close:function(){t.attachemnetVisible=!1}}},[a("a-list",{attrs:{grid:{gutter:16,column:2},dataSource:t.attachments},scopedSlots:t._u([{key:"renderItem",fn:function(e){return a("a-list-item",{},[a("a-card",{attrs:{title:e.fileKey}},[a("img",{attrs:{src:e.path,width:"100%",height:"100px"}}),a("a",{attrs:{href:"javascript:;"},on:{click:function(a){return t.addToTextarea(e)}}},[t._v("详情")])])],1)}}])}),a("a-button",{on:{click:function(e){return t.nextPage(-1)}}},[t._v("上一页")]),a("a-button",{on:{click:function(e){return t.nextPage(1)}}},[t._v("下一页")])],1),a("a-modal",{attrs:{title:"附件详情"},model:{value:t.attachmentDetailsFlag,callback:function(e){t.attachmentDetailsFlag=e},expression:"attachmentDetailsFlag"}},[t.attachmentDetails?a("a-form",[a("a-form-item",{attrs:{label:"路径"}},[a("a-input",{model:{value:t.attachmentDetails.path,callback:function(e){t.$set(t.attachmentDetails,"path",e)},expression:"attachmentDetails.path"}})],1),a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:t.handlePictureType(t.attachmentDetails),expression:"handlePictureType(attachmentDetails)"}],attrs:{label:"ThumbPath"}},[a("a-input",{model:{value:t.attachmentDetails.thumbPath,callback:function(e){t.$set(t.attachmentDetails,"thumbPath",e)},expression:"attachmentDetails.thumbPath"}})],1),t.handleVideoType(t.attachmentDetails)?a("div",[a("video",{staticStyle:{width:"100%"},attrs:{src:t.attachmentDetails.path,controls:""}})]):t._e(),t.handlePictureType(t.attachmentDetails)?a("div",[a("img",{staticStyle:{width:"100%"},attrs:{src:t.attachmentDetails.path,controls:""}})]):t._e(),t.handleMusicType(t.attachmentDetails)?a("div",[a("audio",{staticStyle:{width:"100%"},attrs:{src:t.attachmentDetails.path,controls:""}})]):t._e()],1):t._e()],1)],1)])},i=[],s=(a("4de4"),a("4160"),a("ac1f"),a("5319"),a("1276"),a("159b"),a("b2d8")),r=(a("64e1"),a("c621")),o=a("5c07"),c=a("91b6"),l=a("a796"),u=a("ed66"),m=a("5c11"),h={components:{mavonEditor:s["mavonEditor"]},data:function(){return{queryParam:{originalContent:"",templateName:"",title:"",viewName:"",status:"PUBLISHED",isSource:!1},visible:!1,templates:[],template:void 0,isUpdate:!1,sheetId:null,img_file:{},attachments:[],attachemnetVisible:!1,attachmentDetailsFlag:!1,attachmentDetails:null}},beforeRouteEnter:function(t,e,a){var n=t.query.sheetId;a((function(t){n&&u["a"].findById(n).then((function(e){var a=e.data.data;t.queryParam.originalContent=a.originalContent,t.queryParam.haveHtml=a.haveHtml,t.sheetId=a.id,t.queryParam.templateName=a.templateName,t.queryParam.title=a.title,t.queryParam.viewName=a.viewName,t.queryParam.status=a.status,t.queryParam.isSource=a.isSource,t.isUpdate=!0,t.loadTemplate(a.templateName)}))}))},destroyed:function(){this.removejscssfile()},mounted:function(){this.isUpdate||this.loadTemplate()},methods:{loadAttachment:function(){var t=this;l["a"].list(this.pagination).then((function(e){t.attachments=e.data.data.content}))},imgAdd:function(t,e){var a=this,n=new FormData;n.append("file",e),this.img_file[t]=e,c["a"].upload(n).then((function(e){a.$refs.md.$img2Url(t,e.data.data.thumbPath)}))},imgDel:function(){},change:function(t,e){this.queryParam.formatContent=e},submit:function(){var t=this;this.isUpdate?u["a"].update(this.$route.query.sheetId,this.queryParam).then((function(e){t.$notification["success"]({message:"更新成功:"+e.data.message}),t.$router.push({name:"PageList"})})):u["a"].create(this.queryParam).then((function(e){t.$notification["success"]({message:"添加成功"+e.data.message}),t.$router.push({name:"PageList"})}))},showDrawer:function(){this.visible=!0},onClose:function(){this.visible=!1},removejscssfile:function(){if(this.template&&this.template&&this.template.resource){var t=this.template.resource;t=JSON.parse(t),t.css&&t.css.forEach((function(t){m["a"].removejscssfile(t,"css")})),t.js&&t.js.forEach((function(t){m["a"].removejscssfile(t,"js")}))}},handleChange:function(t){if(this.removejscssfile(),this.template=this.templates.filter((function(e){return e.enName==t}))[0],this.isUpdate||(this.template&&this.template.base?this.queryParam.originalContent=this.template.base:this.queryParam.originalContent=""),this.template&&this.template.resource){var e=this.template.resource;e=JSON.parse(e),e.css&&e.css.forEach((function(t){m["a"].css(m["a"].addPrefix(t))})),e.js&&e.js.forEach((function(t){m["a"].js(m["a"].addPrefix(t))}))}},loadTemplate:function(t){var e=this;r["a"].findByType("SHEET").then((function(a){e.templates=a.data.data,t&&e.handleChange(t)}))},preview:function(){var t=this;this.sheetId?window.open(o["a"].Online("sheet",this.sheetId),"_blank"):u["a"].saveSheet(this.queryParam).then((function(e){t.sheetId=e.data.data.id,t.$notification["success"]({message:"预览之前保存文章"+e.data.message}),window.open(o["a"].Online("sheet",t.sheetId),"_blank")}))},save:function(){var t=this;this.isUpdate?u["a"].modifySheet(this.sheetId,this.queryParam).then((function(e){t.sheetId=e.data.data.id,t.$notification["success"]({message:"更新页面成功:"+e.data.message})})):u["a"].saveSheet(this.queryParam).then((function(e){t.sheetId=e.data.data.id,t.isUpdate=!0,t.$router.replace({query:{sheetId:t.sheetId}}),t.$notification["success"]({message:"保存页面"+e.data.message})}))},onChange:function(t){this.queryParam.isSource=t},openAttachement:function(){this.attachemnetVisible=!0,this.loadAttachment()},addToTextarea:function(t){this.attachmentDetailsFlag=!0,this.attachmentDetails=t},handlePictureType:function(t){var e=t.mediaType;if(e){var a=e.split("/")[0];return"image"===a}return!1},handleMusicType:function(t){var e=t.mediaType;if(e){var a=e.split("/")[0];return"audio"===a}return!1},handleVideoType:function(t){var e=t.mediaType;if(e){var a=e.split("/")[0];return"video"===a}return!1}}},d=h,p=(a("732d"),a("2877")),f=Object(p["a"])(d,n,i,!1,null,null,null);e["default"]=f.exports},"732d":function(t,e,a){"use strict";var n=a("eb50"),i=a.n(n);i.a},eb50:function(t,e,a){},ed66:function(t,e,a){"use strict";var n=a("9efd"),i="/api/sheet",s={list:function(t){return Object(n["a"])({url:i,params:t,method:"get"})},addOrRemoveToMenu:function(t){return Object(n["a"])({url:"".concat(i,"/addOrRemoveToMenu/").concat(t),method:"get"})},findListByChannelId:function(t){return Object(n["a"])({url:"".concat(i,"/findListByChannelId/").concat(t),method:"get"})},deleteById:function(t){return Object(n["a"])({url:"".concat(i,"/delete/").concat(t),method:"get"})},generateHtml:function(t){return Object(n["a"])({url:"".concat(i,"/generate/").concat(t),method:"get"})},query:function(t){return Object(n["a"])({url:i,params:t,method:"get"})},findById:function(t){return Object(n["a"])({url:"".concat(i,"/find/").concat(t),method:"get"})},create:function(t){return Object(n["a"])({url:i,data:t,method:"post"})},saveSheet:function(t){return Object(n["a"])({url:"".concat(i,"/save"),data:t,method:"post"})},modifySheet:function(t,e){return Object(n["a"])({url:"".concat(i,"/save/").concat(t),data:e,method:"post"})},update:function(t,e){return Object(n["a"])({url:"".concat(i,"/update/").concat(t),data:e,method:"post"})}};e["a"]=s}}]);
//# sourceMappingURL=PageCreate.ff48d0ec.js.map