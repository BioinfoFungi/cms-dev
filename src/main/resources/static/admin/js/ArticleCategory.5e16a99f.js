(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["ArticleCategory"],{"0916":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-button",{attrs:{type:"primary"},on:{click:t.initEdit}},[t._v("添加分类")]),a("a-button",{on:{click:function(e){return t.updateAll(!1)}}},[t._v("生成所有分类HTML")]),a("a-button",{on:{click:function(e){return t.updateAll(!0)}}},[t._v("生成所有分类HTML更新模板")]),a("a-button",{attrs:{type:"primary"},on:{click:t.updateCategoryPos}},[t._v("更新顺序")]),a("a-drawer",{attrs:{title:"文章列表",placement:"right",closable:!0,visible:t.articleListDrawer,width:"40rem"},on:{close:function(){t.articleListDrawer=!1}}},[a("a-button",{attrs:{type:"primary"},on:{click:t.updateArticlePos}},[t._v("更新文章顺序")]),a("a-tree",{staticClass:"draggable-tree",attrs:{draggable:"","block-node":"","tree-data":t.articles,"replace-fields":t.articleFieldNames},on:{drop:t.onDropArticle}})],1),a("a-row",[a("a-col",{attrs:{span:8}},[a("a-tree",{staticClass:"draggable-tree",attrs:{draggable:"","block-node":"","tree-data":t.categorys,"replace-fields":t.fieldNames},on:{dragenter:t.onDragEnter,select:t.onSelect,drop:t.onDropCategory}})],1),a("a-col",{attrs:{span:16}},[t.isUpdate?a("div",[a("a-button",{on:{click:function(e){return t.preview(t.updateId)}}},[t._v("预览")]),a("a-button",{on:{click:function(e){return t.openHtml()}}},[t._v("查看Html")]),a("a-button",{on:{click:function(e){return t.remove(t.updateId)}}},[t._v("删除分类")]),a("a-button",{on:{click:function(e){return t.articleListShow(t.updateId)}}},[t._v("查看文章")]),a("a-button",{on:{click:function(e){return t.generateHtml(t.updateId)}}},[t._v("生成HTML")]),t._v(" 是否推荐首页 "),a("a-switch",{attrs:{defaultChecked:""},on:{change:function(e){return t.onChange(t.updateId)}},model:{value:t.categoryParam.recommend,callback:function(e){t.$set(t.categoryParam,"recommend",e)},expression:"categoryParam.recommend"}}),t._v(" 是否添加到导航 "),a("a-switch",{attrs:{defaultChecked:""},on:{change:function(e){return t.onChangeNav(t.updateId)}},model:{value:t.categoryParam.existNav,callback:function(e){t.$set(t.categoryParam,"existNav",e)},expression:"categoryParam.existNav"}}),t._v(" 是否生成Html "),a("a-switch",{attrs:{defaultChecked:""},on:{change:function(e){return t.onChangeHtml(t.updateId)}},model:{value:t.categoryParam.haveHtml,callback:function(e){t.$set(t.categoryParam,"haveHtml",e)},expression:"categoryParam.haveHtml"}}),a("hr")],1):t._e(),a("a-form-item",{attrs:{label:"一页文章数量"}},[a("a-input-number",{attrs:{id:"inputNumber"},model:{value:t.categoryParam.articleListSize,callback:function(e){t.$set(t.categoryParam,"articleListSize",e)},expression:"categoryParam.articleListSize"}})],1),a("a-switch",{attrs:{defaultChecked:""},model:{value:t.categoryParam.desc,callback:function(e){t.$set(t.categoryParam,"desc",e)},expression:"categoryParam.desc"}}),a("a-form",{attrs:{layout:"horizontal"}},[a("a-form-item",{attrs:{label:"视图的名称",help:"不输入.默认生成"}},[a("a-input",{model:{value:t.categoryParam.viewName,callback:function(e){t.$set(t.categoryParam,"viewName",e)},expression:"categoryParam.viewName"}})],1),a("a-form-item",{attrs:{label:"分类名称"}},[a("a-input",{model:{value:t.categoryParam.name,callback:function(e){t.$set(t.categoryParam,"name",e)},expression:"categoryParam.name"}})],1),a("a-form-item",{attrs:{label:"icon"}},[a("a-input",{model:{value:t.categoryParam.icon,callback:function(e){t.$set(t.categoryParam,"icon",e)},expression:"categoryParam.icon"}})],1),a("a-form-item",{attrs:{label:"选择分类信息模板"}},[a("a-select",{staticStyle:{width:"100%"},model:{value:t.categoryParam.templateName,callback:function(e){t.$set(t.categoryParam,"templateName",e)},expression:"categoryParam.templateName"}},t._l(t.templates,(function(e){return a("a-select-option",{key:e.id,attrs:{value:e.enName}},[t._v(t._s(e.name))])})),1)],1),a("a-form-item",{attrs:{label:"选择文章显示的模板"}},[a("a-select",{staticStyle:{width:"100%"},model:{value:t.categoryParam.articleTemplateName,callback:function(e){t.$set(t.categoryParam,"articleTemplateName",e)},expression:"categoryParam.articleTemplateName"}},t._l(t.articleTemplate,(function(e){return a("a-select-option",{key:e.enName,attrs:{value:e.enName}},[t._v(t._s(e.name))])})),1)],1),a("a-form-item",{attrs:{label:"分类的描述"}},[a("a-textarea",{model:{value:t.categoryParam.description,callback:function(e){t.$set(t.categoryParam,"description",e)},expression:"categoryParam.description"}})],1),a("a-form-item",[a("a-upload-dragger",{attrs:{name:"file",multiple:!0,action:t.upload,headers:t.headers,withCredentials:!0},on:{change:t.handleChange}},[a("p",{staticClass:"ant-upload-drag-icon"},[a("img",{attrs:{src:t.categoryParam.picPath,width:"100%",alt:"",srcset:""}})]),a("p",{staticClass:"ant-upload-text"}),a("p",{staticClass:"ant-upload-hint"},[t._v("Support for a single or bulk upload. Strictly prohibit from uploading company data or other band files")])]),a("a-input",{attrs:{placeholder:"直接粘贴图片路径"},model:{value:t.categoryParam.picPath,callback:function(e){t.$set(t.categoryParam,"picPath",e)},expression:"categoryParam.picPath"}})],1),a("a-form-item",{attrs:{label:"父ID"}},[a("a-select",{staticStyle:{width:"100%"},model:{value:t.categoryParam.parentId,callback:function(e){t.$set(t.categoryParam,"parentId",e)},expression:"categoryParam.parentId"}},t._l(t.categorys,(function(e){return a("a-select-option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),a("a-form-item",{attrs:{label:"排序"}},[a("a-input",{model:{value:t.categoryParam.order,callback:function(e){t.$set(t.categoryParam,"order",e)},expression:"categoryParam.order"}})],1)],1),a("a-button",{on:{click:t.handleOk}},[t._v("确认")])],1)],1)],1)},c=[],o=(a("4160"),a("a434"),a("b0c0"),a("a9e3"),a("ac1f"),a("1276"),a("159b"),a("2909")),r=a("c405"),i=a("c621"),l=a("5c07"),s=a("a796"),d=a("2423"),u=[{title:"名称",dataIndex:"name",key:"name",scopedSlots:{customRender:"name"}},{title:"视图名称",dataIndex:"viewName",key:"viewName",scopedSlots:{customRender:"viewName"}},{title:"category模板",dataIndex:"templateName",key:"templateName"},{title:"文章模板",dataIndex:"articleTemplateName",key:"articleTemplateName"},{title:"是否推荐首页",dataIndex:"recommend",key:"recommend",scopedSlots:{customRender:"recommend"}},{title:"是否添加到导航",dataIndex:"existNav",key:"existNav",scopedSlots:{customRender:"existNav"}},{title:"是否生成Html",dataIndex:"haveHtml",key:"haveHtml",scopedSlots:{customRender:"haveHtml"}},{title:"Action",key:"action",fixed:"right",scopedSlots:{customRender:"action"}}],m={data:function(){return{columns:u,form:this.$form.createForm(this,{name:"123"}),categorys:[],parentCategory:[],articles:[],templates:[],articleTemplate:[],isUpdate:!1,updateId:null,visible:!1,currentTabId:null,articleListDrawer:!1,categoryId:null,categoryParam:{order:0,name:"",templateName:"",viewName:"",description:"",picPath:"",articleTemplateName:"",firstArticle:"",articleListSize:10,icon:"",desc:!0,parentId:0},fieldNames:{children:"children",title:"name",key:"id"},articleFieldNames:{children:"children",title:"title",key:"id"}}},created:function(){this.loadcategory(),this.initEdit()},computed:{upload:function(){return s["a"].upload()},headers:function(){var t=localStorage.getItem("Authorization");return{Authorization:"Bearer "+t}}},methods:{loadTempalte:function(){var t=this;i["a"].findByType("CATEGORY").then((function(e){t.templates=e.data.data}))},loadArticleTempalte:function(){var t=this;i["a"].findByType("ARTICLE").then((function(e){t.articleTemplate=e.data.data}))},loadcategory:function(){var t=this;r["a"].listVoTree().then((function(e){t.categorys=e.data.data}))},loadParentCategory:function(){var t=this;i["a"].findByType("CATEGORY").then((function(e){t.templates=e.data.data,t.loadcategory(t.templates[0].enName)}))},loadArticle:function(t){var e=this;d["a"].listVoTree(t).then((function(t){e.articles=t.data.data}))},articleListShow:function(t){this.categoryId=t,this.loadArticle(t),this.articleListDrawer=!0},handleChange:function(t){var e=t.file.status;"done"===e?(this.categoryParam.picPath=t.file.response.data.path,this.$message.success("".concat(t.file.name," file uploaded successfully."))):"error"===e&&this.$message.error("".concat(t.file.name," file upload failed."))},handleOk:function(){var t=this;this.categoryParam.name?(this.isUpdate?r["a"].update(this.updateId,this.categoryParam).then((function(e){t.$notification["success"]({message:"成功更新数据:"+e.data.data.name}),t.loadcategory()})):r["a"].add(this.categoryParam).then((function(e){t.$notification["success"]({message:"成功添加:"+e.data.data.name}),t.loadcategory()})),this.visible=!1):this.$notification["error"]({message:"分类标题不能为空!!"})},initEdit:function(){this.loadTempalte(),this.loadArticleTempalte(),this.categoryParam={},this.isUpdate=!1,this.visible=!0},edit:function(t){var e=this;this.loadTempalte(),this.loadArticleTempalte(),r["a"].findById(t).then((function(a){e.isUpdate=!0,e.updateId=t,e.categoryParam=a.data.data,e.visible=!0}))},onChange:function(t){var e=this;r["a"].recommendOrCancel(t).then((function(t){t.data.data.recommend?e.$notification["success"]({message:"分类"+t.data.data.name+"成功在首页推荐!!"}):e.$notification["success"]({message:"分类"+t.data.data.name+"已经从首页取消推荐!!"})}))},onChangeNav:function(t){var e=this;r["a"].addOrRemoveToMenu(t).then((function(t){t.data.data.existNav?e.$notification["success"]({message:"成功添加"+t.data.data.name+"到导航!!"}):e.$notification["success"]({message:"成功移除"+t.data.data.name+"到导航!!"})}))},onChangeHtml:function(t){var e=this;r["a"].haveHtml(t).then((function(t){var a=t.data.data;a.haveHtml?e.$notification["success"]({message:"成功生成"+a.name+"Html"}):e.$notification["success"]({message:"成功移除"+a.name+"Html"}),e.loadcategory()}))},remove:function(t){var e=this;r["a"].deleteById(t).then((function(t){e.$notification["success"]({message:t.data.message}),e.loadcategory(e.currentTabId)}))},preview:function(t){window.open(l["a"].Online("category",t),"_blank")},openHtml:function(){window.open(l["a"].Html(this.categoryParam.path+"/"+this.categoryParam.viewName),"_blank")},openHtmlFirstArticle:function(t){t.haveHtml?window.open(l["a"].Html(t.path+"/"+t.viewName+"/"+t.firstArticle),"_blank"):this.$message.error("该分类没有生成HTML")},onClose:function(){this.articleVisible=!1},generateHtml:function(t){var e=this;r["a"].generateHtml(t).then((function(t){e.$notification["success"]({message:"成功生成"+t.data.data.name+"的HTML"})}))},onSelect:function(t){this.edit(t)},onDragEnter:function(){},updateCategoryPos:function(){var t=this;r["a"].updatePos(this.categorys).then((function(e){t.loadcategory(),t.initEdit(),t.$notification["success"]({message:"顺序更新"+e.data.message})}))},updateArticlePos:function(){var t=this;d["a"].updatePos(this.categoryId,this.articles).then((function(e){t.$notification["success"]({message:"顺序更新"+e.data.message}),t.generateHtml(t.updateId)}))},onDropArticle:function(t){this.onDrop(t,"articles","children")},onDropCategory:function(t){this.onDrop(t,"categorys","children")},onDrop:function(t,e,a){var n=t.node.eventKey,c=t.dragNode.eventKey,r=t.node.pos.split("-"),i=t.dropPosition-Number(r[r.length-1]),l=function t(e,n,c){e.forEach((function(e,o,r){return e.id===n?c(e,o,r):e[a]?t(e[a],n,c):void 0}))},s=Object(o["a"])(this[e]),d={};if(l(s,c,(function(t,e,a){a.splice(e,1),d=t})),t.dropToGap)if((t.node[a]||[]).length>0&&t.node.expanded&&1===i)l(s,n,(function(t){t[a]=t[a]||[],t[a].unshift(d)}));else{var u=[],m=0;l(s,n,(function(t,e,a){u=a,m=e})),-1===i?u.splice(m,0,d):u.splice(m+1,0,d)}else l(s,n,(function(t){t[a]=t[a]||[],t[a].push(d)}));this[e]=s},updateAll:function(t){var e=this;this.$confirm({title:"你确定生成所有栏目HTML?",content:"Some descriptions",okText:"Yes",okType:"danger",cancelText:"No",onOk:function(){t?r["a"].updateAll({more:!0}).then((function(t){e.$notification["success"]({message:"成功生成栏目Id为:"+t.data.data+"的HTML页面"}),e.loadcategory(e.currentTabId)})):r["a"].updateAll().then((function(t){e.$notification["success"]({message:"成功生成栏目Id为:"+t.data.data+"的HTML页面"}),e.loadcategory(e.currentTabId)}))},onCancel:function(){}})}}},p=m,f=(a("1dda"),a("2877")),h=Object(f["a"])(p,n,c,!1,null,null,null);e["default"]=h.exports},"1c7e5":function(t,e,a){},"1dda":function(t,e,a){"use strict";var n=a("1c7e5"),c=a.n(n);c.a},2423:function(t,e,a){"use strict";var n=a("9efd"),c="/api/article",o={delete:function(t){return Object(n["a"])({url:"".concat(c,"/delete/").concat(t),method:"get"})},updateAll:function(t){return Object(n["a"])({url:"".concat(c,"/updateAll"),params:t,method:"get"})},query:function(t){return Object(n["a"])({url:c,params:t,method:"get"})},updateCategory:function(t,e){return Object(n["a"])({url:"".concat(c,"/updateCategory/").concat(t),params:{baseCategoryId:e},method:"get"})},addArticleToChannel:function(t,e){return Object(n["a"])({url:"".concat(c,"/addArticleToChannel/").concat(t),params:{channelId:e},method:"get"})},queryTitle:function(t){return Object(n["a"])({url:"".concat(c,"/query"),params:{title:t},method:"get"})},listByComponentsId:function(t){return Object(n["a"])({url:"".concat(c,"/listByComponentsId/").concat(t),method:"get"})},updateOrderBy:function(t,e){return Object(n["a"])({url:"".concat(c,"/updateOrderBy/").concat(t),params:{order:e},method:"get"})},pageByTagId:function(t,e){return Object(n["a"])({url:"".concat(c,"/pageByTagId/").concat(t),params:e,method:"get"})},listVoTree:function(t,e){return Object(n["a"])({url:"".concat(c,"/listVoTree/").concat(t),params:e,method:"get"})},findById:function(t){return Object(n["a"])({url:"".concat(c,"/find/").concat(t),method:"get"})},openOrCloseComment:function(t){return Object(n["a"])({url:"".concat(c,"/openOrCloseComment/").concat(t),method:"get"})},haveHtml:function(t){return Object(n["a"])({url:"".concat(c,"/haveHtml/").concat(t),method:"get"})},sendOrCancelTop:function(t){return Object(n["a"])({url:"".concat(c,"/sendOrCancelTop/").concat(t),method:"get"})},create:function(t){return Object(n["a"])({url:c,data:t,method:"post"})},saveArticle:function(t){return Object(n["a"])({url:"".concat(c,"/save"),data:t,method:"post"})},updatePos:function(t,e){return Object(n["a"])({url:"".concat(c,"/updatePos/").concat(t),data:e,method:"post"})},updateArticle:function(t,e){return Object(n["a"])({url:"".concat(c,"/save/").concat(t),data:e,method:"post"})},update:function(t,e){return Object(n["a"])({url:"".concat(c,"/update/").concat(t),data:e,method:"post"})},generateHtml:function(t){return Object(n["a"])({url:"".concat(c,"/generateHtml/").concat(t),method:"get"})}};e["a"]=o},a796:function(t,e,a){"use strict";a("99af");var n=a("9efd"),c=a("72ac"),o="/api/attachment",r={upload:function(){return"http://".concat(c["a"].baseUrl,":").concat(c["a"].port,"/api/attachment/upload")},uploadBib:function(){return"http://".concat(c["a"].baseUrl,":").concat(c["a"].port,"/api/attachment/uploadBib?update=true")},list:function(t){return Object(n["a"])({url:o,params:t,method:"get"})}};e["a"]=r},c405:function(t,e,a){"use strict";a("4160"),a("b0c0"),a("159b");var n=a("9efd"),c="/api/category",o={};function r(t,e){e.forEach((function(e){t.key===e.parentId&&(t.children||(t.children=[]),t.children.push({key:e.id,title:e.name,isLeaf:!1,scopedSlots:{title:"custom"}}))})),t.children?t.children.forEach((function(t){return r(t,e)})):t.isLeaf=!0}o.listByParent=function(t){return Object(n["a"])({url:"".concat(c,"/listByParentId/").concat(t),method:"get"})},o.list=function(){return Object(n["a"])({url:c,method:"get"})},o.listVoTree=function(){return Object(n["a"])({url:"".concat(c,"/listVoTree"),method:"get"})},o.updateAll=function(t){return Object(n["a"])({url:"".concat(c,"/updateAll"),params:t,method:"get"})},o.add=function(t){return Object(n["a"])({url:c,method:"post",data:t})},o.updatePos=function(t){return Object(n["a"])({url:"".concat(c,"/updatePos"),method:"post",data:t})},o.update=function(t,e){return Object(n["a"])({url:"".concat(c,"/update/").concat(t),method:"post",data:e})},o.findById=function(t){return Object(n["a"])({url:"".concat(c,"/find/").concat(t),method:"get"})},o.pageBy=function(t){return Object(n["a"])({url:"".concat(c,"/template/").concat(t),method:"get"})},o.recommendOrCancel=function(t){return Object(n["a"])({url:"".concat(c,"/recommendOrCancel/").concat(t),method:"get"})},o.addOrRemoveToMenu=function(t){return Object(n["a"])({url:"".concat(c,"/addOrRemoveToMenu/").concat(t),method:"get"})},o.haveHtml=function(t){return Object(n["a"])({url:"".concat(c,"/haveHtml/").concat(t),method:"get"})},o.deleteById=function(t){return Object(n["a"])({url:"".concat(c,"/delete/").concat(t),method:"get"})},o.findByCategoryDetail=function(t){return Object(n["a"])({url:"".concat(c,"/find/categoryDetail/").concat(t),method:"get"})},o.generateHtml=function(t){return Object(n["a"])({url:"".concat(c,"/generateHtml/").concat(t),method:"get"})},o.concreteTree=function(t){var e={key:0,title:"top",children:[]};return r(e,t),e.children},e["a"]=o},c621:function(t,e,a){"use strict";a("99af");var n=a("9efd"),c=a("72ac"),o="/api/template",r={update:function(t,e){return Object(n["a"])({url:"".concat(o,"/update/").concat(t),data:e,method:"post"})},findDetailsById:function(t){return Object(n["a"])({url:"".concat(o,"/findDetailsById/").concat(t),method:"get"})},findByType:function(t){return Object(n["a"])({url:"".concat(o,"/find/").concat(t),method:"get"})},tree:function(t){return Object(n["a"])({url:"".concat(o,"/tree/").concat(t),method:"get"})},deleteById:function(t){return Object(n["a"])({url:"".concat(o,"/delete/").concat(t),method:"get"})},list:function(t){return Object(n["a"])({url:o,params:t,method:"get"})},add:function(t){return Object(n["a"])({url:o,data:t,method:"post"})},upload:function(){return"http://".concat(c["a"].baseUrl,":").concat(c["a"].port,"/api/template/upload")}};e["a"]=r}}]);
//# sourceMappingURL=ArticleCategory.5e16a99f.js.map